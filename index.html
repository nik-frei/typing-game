<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Typing Adventure ğŸš€</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html, body { height: 100%; overflow-x: hidden; }
body {
  background: linear-gradient(135deg, #0f0b1e 0%, #1a1145 40%, #0d1b2a 100%);
  color: #e0e7ff;
  font-family: 'Nunito', 'Segoe UI', sans-serif;
  min-height: 100vh;
  min-height: 100dvh;
}

@keyframes twinkle { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
@keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-12px); } }
@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
@keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
@keyframes popIn { from { opacity: 0; transform: scale(0.5); } to { opacity: 1; transform: scale(1); } }
@keyframes glow { 0%, 100% { text-shadow: 0 0 20px rgba(129,140,248,0.3); } 50% { text-shadow: 0 0 40px rgba(129,140,248,0.6), 0 0 80px rgba(129,140,248,0.3); } }
@keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-6px); } 75% { transform: translateX(6px); } }

.star { position: absolute; width: 2px; height: 2px; background: #fff; border-radius: 50%; }
.mono { font-family: 'JetBrains Mono', 'Fira Code', monospace; }

button { font-family: 'Nunito', sans-serif; cursor: pointer; transition: all 0.2s; }
button:active { transform: scale(0.97) !important; }

.hidden-input {
  position: fixed; top: -100px; left: -100px; opacity: 0;
  width: 1px; height: 1px; font-size: 16px;
}

.char { transition: color 0.1s; }
</style>
</head>
<body>

<div id="app"></div>

<script>
const RECENT_WINDOW = 10;
const MASTERY_THRESHOLD = 75;
const ALL_KEYS = "abcdefghijklmnopqrstuvwxyz".split("");

const FINGER_MAP = {
  a:"Left pinky",s:"Left ring",d:"Left middle",f:"Left index",g:"Left index",
  h:"Right index",j:"Right index",k:"Right middle",l:"Right ring",
  q:"Left pinky",w:"Left ring",e:"Left middle",r:"Left index",t:"Left index",
  y:"Right index",u:"Right index",i:"Right middle",o:"Right ring",p:"Right pinky",
  z:"Left pinky",x:"Left ring",c:"Left middle",v:"Left index",b:"Left index",
  n:"Right index",m:"Right index"
};

const WORDS = {
  easy:["cat","dog","hat","sun","red","big","fun","run","hop","cup","log","map","net","pin","top","van","wig","box","yes","zip","ant","bed","dig","egg","fig","gum","hen","ink","jam","kit","mud","nap","owl","pet","rug","sit","ten","yak"],
  medium:["jump","fish","blue","tree","frog","duck","bear","cake","moon","star","book","bell","drum","flag","gift","hand","kite","lamp","nest","pond","ring","ship","tent","wave","yarn","swim","glad","snap","clap","glow"],
  hard:["adventure","butterfly","champion","dinosaur","elephant","fantastic","giraffe","homework","imagine","joyful","kangaroo","lemonade","mountain","notebook","octopus","parachute","question","rainbow","sandwich","treasure"]
};

const FUN_FACTS = [
  "ğŸš€ Astronauts float because they're always falling!",
  "â­ There are more stars than grains of sand on Earth!",
  "ğŸŒ Earth spins at 1,000 miles per hour!",
  "ğŸŒ™ The Moon drifts farther from Earth each year!",
  "â˜€ï¸ Sunlight takes 8 minutes to reach us!",
  "ğŸª Saturn is light enough to float in water!",
  "ğŸ›¸ A day on Venus is longer than a year on Venus!",
  "ğŸ’« Some stars spin 600 times per second!",
  "ğŸŒŒ Space is totally silent â€” there's no air for sound!"
];

const CHEERS = ["Amazing! ğŸŒŸ","Superstar! â­","Go astronaut! ğŸš€","So fast! âš¡","On fire! ğŸ”¥","Nailed it! ğŸ‰","Champion! ğŸ†","Wow! ğŸŒˆ","Incredible! ğŸ’«","Yes! ğŸ¯"];

let S = {
  screen:"menu", keyStats:{}, level:1, xp:0, totalXp:0,
  target:"", typed:"", errors:new Set(),
  totalChars:0, correctChars:0, streak:0, bestStreak:0,
  startTime:null, wpm:0,
  roundComplete:false, roundsPlayed:0,
  cheer:"", funFact:"", shakePos:-1
};

try {
  const d = JSON.parse(localStorage.getItem("ta-save"));
  if (d) { S.keyStats=d.k||{}; S.level=d.l||1; S.totalXp=d.x||0; }
} catch(e) {}
ALL_KEYS.forEach(k => { if (!S.keyStats[k]) S.keyStats[k]={a:0,e:0,r:[],m:50}; });

function save() { try { localStorage.setItem("ta-save",JSON.stringify({k:S.keyStats,l:S.level,x:S.totalXp})); } catch(e){} }

function mastery(s) {
  if(s.a===0)return 50;
  const rec=s.r.slice(-RECENT_WINDOW);
  if(!rec.length)return 50;
  return Math.round((rec.filter(Boolean).length/rec.length)*70+((s.a-s.e)/s.a)*30);
}

function weakKeys(n=5) {
  return ALL_KEYS.filter(k=>S.keyStats[k].a>0).sort((a,b)=>S.keyStats[a].m-S.keyStats[b].m).slice(0,n);
}

function pickWord(weak,diff) {
  const list=WORDS[diff]||WORDS.easy;
  if(weak.length){const ws=new Set(weak);const t=list.filter(w=>[...w].some(c=>ws.has(c)));if(t.length)return t[Math.floor(Math.random()*t.length)];}
  return list[Math.floor(Math.random()*list.length)];
}

function makeSequence(n=5) {
  const w=weakKeys(); const diff=S.level<=3?"easy":S.level<=7?"medium":"hard";
  const words=[]; for(let i=0;i<n;i++)words.push(pickWord(i<3?w:[],diff));
  return words.join(" ");
}

function startRound() {
  S.target=makeSequence(); S.typed=""; S.errors=new Set();
  S.startTime=null; S.roundComplete=false;
  S.funFact=""; S.cheer=""; S.shakePos=-1;
  render();
  setTimeout(()=>document.getElementById("hi")?.focus(),100);
}

function startGame() {
  S.screen="game"; S.totalChars=0; S.correctChars=0;
  S.streak=0; S.bestStreak=0; S.wpm=0; S.xp=0; S.roundsPlayed=0;
  startRound();
}

function handleKey(e) {
  if(S.screen!=="game"||S.roundComplete)return;
  if(e.key==="Escape"){S.screen="menu";render();return;}
  if(e.key.length!==1&&e.key!=="Backspace")return;
  e.preventDefault();
  if(e.key==="Backspace"){S.typed=S.typed.slice(0,-1);render();return;}

  const pos=S.typed.length;
  if(pos>=S.target.length)return;
  if(!S.startTime)S.startTime=Date.now();

  const expected=S.target[pos];
  const correct=e.key===expected;
  const lk=e.key.toLowerCase();

  if(/^[a-z]$/.test(lk)){
    const st=S.keyStats[lk];
    st.a++;st.r=[...st.r.slice(-(RECENT_WINDOW-1)),correct];
    if(!correct)st.e++;st.m=mastery(st);
    if(!correct&&/^[a-z]$/.test(expected.toLowerCase())&&expected.toLowerCase()!==lk){
      const es=S.keyStats[expected.toLowerCase()];
      es.a++;es.e++;es.r=[...es.r.slice(-(RECENT_WINDOW-1)),false];es.m=mastery(es);
    }
  }

  S.totalChars++;

  if(correct){
    S.typed+=e.key;S.correctChars++;S.streak++;
    if(S.streak>S.bestStreak)S.bestStreak=S.streak;
    if(S.streak>0&&S.streak%12===0){
      S.cheer=CHEERS[Math.floor(Math.random()*CHEERS.length)];
      setTimeout(()=>{S.cheer="";render();},1800);
    }
    if(S.startTime){const el=(Date.now()-S.startTime)/60000;if(el>0)S.wpm=Math.round(S.typed.length/5/el);}
    if(pos+1===S.target.length){
      const el=(Date.now()-S.startTime)/60000;
      S.wpm=el>0?Math.round(S.target.length/5/el):0;
      S.roundComplete=true;S.roundsPlayed++;
      const acc=S.totalChars>0?S.correctChars/S.totalChars:1;
      const earned=Math.round(10+acc*20+Math.min(S.wpm,50));
      S.xp+=earned;S.totalXp+=earned;
      if(S.xp>=100){S.level++;S.xp-=100;}
      S.funFact=FUN_FACTS[Math.floor(Math.random()*FUN_FACTS.length)];
      save();
    }
  } else {
    S.errors.add(pos);S.streak=0;S.shakePos=pos;
    setTimeout(()=>{S.shakePos=-1;render();},300);
  }
  render();
}

document.addEventListener("keydown",handleKey);
document.addEventListener("input",function(){
  const inp=document.getElementById("hi");
  if(!inp||S.screen!=="game"||S.roundComplete)return;
  if(inp.value.length>0){handleKey({key:inp.value[inp.value.length-1],preventDefault:()=>{}});inp.value="";}
});

let starsHTML='<div style="position:fixed;inset:0;pointer-events:none;z-index:0">';
for(let i=0;i<50;i++){starsHTML+=`<div class="star" style="left:${(Math.random()*100).toFixed(1)}%;top:${(Math.random()*100).toFixed(1)}%;opacity:${(Math.random()*0.6+0.2).toFixed(2)};animation:twinkle ${(2+Math.random()*4).toFixed(1)}s ${(Math.random()*3).toFixed(1)}s ease-in-out infinite"></div>`;}
starsHTML+='</div>';

function render(){
  const app=document.getElementById("app");
  const acc=S.totalChars>0?Math.round((S.correctChars/S.totalChars)*100):100;
  const curKey=S.target[S.typed.length]?.toLowerCase();

  // â”€â”€ Menu â”€â”€
  if(S.screen==="menu"){
    app.innerHTML=`${starsHTML}
    <div style="min-height:100vh;min-height:100dvh;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;z-index:1;padding:24px;text-align:center">
      <div style="animation:slideUp 0.8s ease-out">
        <div style="font-size:80px;margin-bottom:12px;animation:float 3s ease-in-out infinite">ğŸš€</div>
        <h1 style="font-size:52px;font-weight:900;margin-bottom:12px;background:linear-gradient(135deg,#c7d2fe,#818cf8,#6366f1);-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:glow 3s ease-in-out infinite">Typing Adventure</h1>
        <p style="font-size:20px;color:rgba(255,255,255,0.4);margin-bottom:56px;font-weight:600">Launch your typing skills into orbit!</p>
        <div style="display:flex;flex-direction:column;gap:16px;align-items:center">
          <button onclick="startGame()" style="padding:18px 56px;font-size:22px;font-weight:800;border-radius:16px;border:none;background:linear-gradient(135deg,#6366f1,#818cf8);color:#fff;box-shadow:0 4px 24px rgba(99,102,241,0.4)">ğŸš€ Start Mission</button>
          <button onclick="S.screen='stats';render()" style="padding:14px 40px;font-size:17px;font-weight:700;border-radius:12px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:rgba(255,255,255,0.6)">ğŸ“Š View Progress</button>
        </div>
        <div style="margin-top:56px;font-size:15px;color:rgba(255,255,255,0.2)">Level ${S.level} Â· ${S.totalXp} XP</div>
      </div>
    </div>`;
    return;
  }

  // â”€â”€ Stats â”€â”€
  if(S.screen==="stats"){
    const practiced=ALL_KEYS.filter(k=>S.keyStats[k].a>0);
    const avgM=practiced.length?Math.round(practiced.reduce((a,k)=>a+S.keyStats[k].m,0)/practiced.length):0;
    let grid='';
    ALL_KEYS.forEach(k=>{
      const s=S.keyStats[k];const hp=s.a>0;const m=s.m;
      let bg,bd,cl;
      if(!hp){bg="rgba(255,255,255,0.02)";bd="rgba(255,255,255,0.05)";cl="rgba(255,255,255,0.15)";}
      else if(m>=90){bg="rgba(34,197,94,0.25)";bd="rgba(34,197,94,0.4)";cl="#86efac";}
      else if(m>=75){bg="rgba(34,197,94,0.12)";bd="rgba(34,197,94,0.25)";cl="#86efac";}
      else if(m>=50){bg="rgba(251,191,36,0.15)";bd="rgba(251,191,36,0.3)";cl="#fcd34d";}
      else{bg="rgba(239,68,68,0.18)";bd="rgba(239,68,68,0.3)";cl="#fca5a5";}
      grid+=`<div style="background:${bg};border:2px solid ${bd};border-radius:14px;padding:12px 6px;text-align:center">
        <div class="mono" style="font-size:24px;font-weight:800;color:${cl};text-transform:uppercase">${k}</div>
        ${hp?`<div style="font-size:15px;font-weight:700;color:${cl};opacity:0.8;margin-top:2px">${m}%</div>`:''}
      </div>`;
    });
    app.innerHTML=`${starsHTML}
    <div style="min-height:100vh;min-height:100dvh;display:flex;flex-direction:column;align-items:center;padding:40px 24px;position:relative;z-index:1;overflow:auto">
      <div style="max-width:600px;width:100%;animation:slideUp 0.6s ease-out">
        <button onclick="S.screen='menu';render()" style="padding:10px 24px;font-size:16px;font-weight:700;border-radius:10px;border:1px solid rgba(255,255,255,0.12);background:rgba(255,255,255,0.05);color:rgba(255,255,255,0.5);margin-bottom:28px">â† Back</button>
        <h2 style="font-size:32px;font-weight:900;margin-bottom:6px">ğŸ“Š Mission Report</h2>
        <p style="color:rgba(255,255,255,0.35);margin-bottom:28px;font-size:16px">Level ${S.level} Â· ${practiced.length}/26 letters Â· ${avgM}% average</p>
        ${practiced.length===0?'<div style="text-align:center;padding:48px;color:rgba(255,255,255,0.3);font-size:18px"><div style="font-size:56px;margin-bottom:16px">ğŸ”­</div>No data yet â€” start a mission!</div>':`
          <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(64px,1fr));gap:10px">${grid}</div>
          <div style="margin-top:24px;text-align:center">
            <button onclick="if(confirm('Reset all progress?')){ALL_KEYS.forEach(k=>S.keyStats[k]={a:0,e:0,r:[],m:50});S.level=1;S.totalXp=0;save();render()}" style="padding:10px 24px;font-size:14px;font-weight:700;border-radius:10px;border:1px solid rgba(239,68,68,0.2);background:transparent;color:rgba(239,68,68,0.5)">Reset Progress</button>
          </div>`}
      </div>
    </div>`;
    return;
  }

  // â”€â”€ Game â”€â”€
  let typingHTML='';
  S.target.split("").forEach((char,i)=>{
    let color,extra='';
    if(i<S.typed.length){
      color=S.errors.has(i)?"#ef4444":"#22c55e";
      if(S.errors.has(i))extra='text-decoration:line-through;';
    } else if(i===S.typed.length){
      color="#fff";
      extra='background:rgba(99,102,241,0.35);border-radius:8px;padding:6px 3px;';
      if(S.shakePos===-1)extra+='animation:pulse 0.8s ease-in-out infinite;';
    } else {
      color="rgba(255,255,255,0.18)";
    }
    if(i===S.shakePos)extra+='animation:shake 0.3s ease;color:#ef4444;';
    typingHTML+=`<span class="char" style="color:${color};${extra}">${char===" "?"&nbsp;":char}</span>`;
  });

  const pct=S.target.length>0?Math.round((S.typed.length/S.target.length)*100):0;
  const weak=weakKeys(4).filter(k=>S.keyStats[k].m<MASTERY_THRESHOLD);

  app.innerHTML=`${starsHTML}
  <input id="hi" class="hidden-input" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <div style="min-height:100vh;min-height:100dvh;display:flex;flex-direction:column;position:relative;z-index:1;padding:20px 24px" onclick="document.getElementById('hi').focus()">

    <!-- Top bar -->
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
      <button onclick="S.screen='menu';render()" style="padding:8px 20px;font-size:15px;font-weight:700;border-radius:10px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:rgba(255,255,255,0.4)">â† Menu</button>
      <div style="display:flex;gap:24px">
        <div class="mono" style="font-size:18px;font-weight:700;color:rgba(255,255,255,0.35)">âš¡ ${S.wpm}</div>
        <div class="mono" style="font-size:18px;font-weight:700;color:rgba(255,255,255,0.35)">ğŸ¯ ${acc}%</div>
        <div class="mono" style="font-size:18px;font-weight:700;color:rgba(255,255,255,0.35)">ğŸ”¥ ${S.streak}</div>
      </div>
    </div>

    <!-- Progress bar -->
    <div style="width:100%;height:5px;border-radius:5px;background:rgba(255,255,255,0.06);margin-bottom:0;overflow:hidden">
      <div style="height:100%;width:${pct}%;background:linear-gradient(90deg,#6366f1,#818cf8);border-radius:5px;transition:width 0.3s ease"></div>
    </div>

    ${S.cheer?`<div style="text-align:center;font-size:36px;font-weight:900;color:#fbbf24;animation:popIn 0.3s ease-out;margin-top:20px">${S.cheer}</div>`:''}

    <!-- Main typing area â€” BIG and centered -->
    <div style="flex:1;display:flex;align-items:center;justify-content:center;padding:0 4px">
      <div class="mono" style="font-size:48px;line-height:1.8;letter-spacing:4px;font-weight:700;word-break:break-word;text-align:center;max-width:720px">
        ${typingHTML}
      </div>
    </div>

    <!-- Finger hint -->
    ${curKey&&FINGER_MAP[curKey]&&!S.roundComplete?`
      <div style="text-align:center;padding:12px 0">
        <span class="mono" style="font-size:20px;color:rgba(255,255,255,0.25)">
          <span style="color:#818cf8;font-weight:800;font-size:26px">${curKey.toUpperCase()}</span>
          &nbsp;${FINGER_MAP[curKey]}
        </span>
      </div>
    `:''}

    <!-- Weak keys -->
    ${weak.length>0&&!S.roundComplete?`
      <div style="text-align:center;padding:4px 0 12px">
        <span style="font-size:14px;color:rgba(255,255,255,0.15)">Practicing: </span>
        ${weak.map(k=>`<span class="mono" style="display:inline-block;width:34px;height:34px;line-height:34px;text-align:center;border-radius:8px;font-size:17px;font-weight:800;text-transform:uppercase;background:rgba(251,191,36,0.12);border:1px solid rgba(251,191,36,0.2);color:#fcd34d;margin:0 3px">${k}</span>`).join('')}
      </div>
    `:''}

    <!-- Round complete modal -->
    ${S.roundComplete?`
      <div style="position:fixed;inset:0;background:rgba(0,0,0,0.65);display:flex;align-items:center;justify-content:center;z-index:10;padding:24px" onclick="event.stopPropagation()">
        <div style="background:linear-gradient(135deg,#1a1145,#0d1b2a);border-radius:28px;border:1px solid rgba(99,102,241,0.3);padding:44px;text-align:center;max-width:440px;width:100%;animation:slideUp 0.5s ease-out">
          <div style="font-size:60px;margin-bottom:14px">ğŸ‰</div>
          <div style="font-size:30px;font-weight:900;margin-bottom:12px">Mission Complete!</div>
          <div style="display:flex;justify-content:center;gap:36px;margin:24px 0">
            <div><div class="mono" style="font-size:36px;font-weight:800;color:#818cf8">${S.wpm}</div><div style="font-size:15px;color:rgba(255,255,255,0.4)">WPM</div></div>
            <div><div class="mono" style="font-size:36px;font-weight:800;color:#22c55e">${acc}%</div><div style="font-size:15px;color:rgba(255,255,255,0.4)">Accuracy</div></div>
            <div><div class="mono" style="font-size:36px;font-weight:800;color:#fbbf24">${S.bestStreak}</div><div style="font-size:15px;color:rgba(255,255,255,0.4)">Streak</div></div>
          </div>
          <div style="background:rgba(255,255,255,0.04);border-radius:14px;padding:16px 20px;font-size:17px;color:rgba(255,255,255,0.5);margin:24px 0;font-style:italic;line-height:1.5">${S.funFact}</div>
          <button onclick="startRound()" style="padding:18px 52px;font-size:22px;font-weight:800;border-radius:16px;border:none;background:linear-gradient(135deg,#6366f1,#818cf8);color:#fff;box-shadow:0 4px 24px rgba(99,102,241,0.4)">ğŸš€ Next Mission</button>
          <div style="margin-top:16px"><button onclick="S.screen='menu';render()" style="padding:10px 24px;font-size:15px;font-weight:600;border-radius:10px;border:1px solid rgba(255,255,255,0.1);background:transparent;color:rgba(255,255,255,0.3)">Back to Menu</button></div>
        </div>
      </div>
    `:''}

    <div style="text-align:center;font-size:12px;color:rgba(255,255,255,0.08);padding:4px 0">Level ${S.level} Â· ${S.totalXp} XP</div>
  </div>`;

  document.getElementById("hi")?.focus();
}

render();
</script>
</body>
</html>
